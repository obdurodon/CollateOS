<!DOCTYPE html SYSTEM "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <link rel="stylesheet" type="text/css" href="http://www.obdurodon.org/css/style.css" />
        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
        <!--#set var="title" value="Aligning the PVL with CollateOS" -->
        <!--#config timefmt="%Y-%m-%dT%X%z" -->
        <title>
            <!--#echo encoding="none" var="title" -->
        </title>
        <!--#include virtual="../inc/pvl-header.html" -->
        <style type="text/css">
            table.collation-example{
                border:none;
            }
            p.columnNumber{
                padding-left:5px;
            }
            .collation-example tr{
                padding:0;
                margin:0;
            }
            .collation-example td,
            .collation-example th{
                padding:0 8px 0;
                margin:0;
                border:none;
            }
            .collation-example th{
                font-style:italic;
                border-right:1px gray solid;
            }
            span.manuscripts,
            span.editions,
            span.lemma{
                font-family:Bukyvede, BukyvedeWeb;
                font-size:larger;
                font-weight:normal;
                color:black;
                line-height:1.1em;
            }</style>
    </head>
    <body>
        <!--#include virtual="../inc/pvl-boilerplate.html" -->
        <h3>Synopsis</h3>
        <p>CollateOS, a preprocessing protocol for CollateX, is a knowledge-based system that
            normalizes variation in early Cyrillic orthography so as to improve the accuracy of the
            CollateX alignment of early Slavic materials. The CollateOS preprocessing protocol was
            developed by David J. Birnbaum (<a href="mailto:djbpitt@gmail.com"
            >djbpitt@gmail.com</a>) and Minas Abovyan. For more information about CollateX see <a
                href="http://collatex.net">http://collatex.net</a>.</p>
        <p>The <cite>PVL</cite> is the <cite>Rus′ primary chronicle</cite> (<cite>Повесть временных
                лет</cite> in modern Russian), a history of Rus′ that was compiled and edited
            several times before the early twelfth century, and that survives in manuscripts no
            earlier than 1377, which do not always agree with one another in their readings.
                <dfn>Collation</dfn> is the process of aligning the variant readings in the
            manuscript witnesses so that they can be compared, with the goal of determining the
            original text, as well its subsequent history as it was copied repeatedly, with each new
            copy introducing deliberate or inadvertent deviations from its immediate source text.
            The digital edition available at <a href="http://collatex.net"
                >http://pvl.obdurodon.org</a> is based on <a
                href="http://www.hup.harvard.edu/catalog.php?isbn=9780916458911"><cite>The Povest′
                    vremennykh let: An interlinear collation and paradosis</cite>, ed. Donald
                Ostrowski, with David Birnbaum and Horace G. Lunt. (Harvard Ukrainian Research
                Institute Publications: Texts, 10.) Cambridge, MA: Harvard UP, 2003. ISBN
                9780916458911.</a></p>
        <h3>System requirements</h3>
        <ul>
            <li>
                <a href="http://collatex.net/">CollateX</a>
            </li>
            <li>
                <a href="https://www.python.org/">Python 2.7</a>
            </li>
            <li><a href="http://saxon.sourceforge.net/">Saxon HE</a> (or other XSLT transformation
                engine)</li>
        </ul>
        <h3>Pipeline</h3>
        <p>
            <img alt="[Pipeline]" src="pipeline1.png" style="width: 100%;" />
        </p>
        <p>In the pipeline diagram above, the bottom tier lists the document formats: XML, JSON, and
            HTML. The middle tier lists the programming languages used for each stage of the
            transformation: XSLT and Python. The one item on the top tier indicates that CollateX, a
            Java application, is launched by a Python program, and not directly by the user. There
            is a wrapper script that enables the user to oipeline all of the Python processes with a
            single command (see below).</p>
        <h3>The original input</h3>
        <p>The PVL source file, <a href="../dev/pvl.xml">pvl.xml</a> (9.2M), contains a line-level
            (not word-level) collation of all manuscript witnesses, with the lineation based on E.
            F. Karskijʹs 1926 edition of the Laurentian manuscript, which has come to be regarded as
            the closest thing we have to a canonical reference system for the PVL.<sup><a
                    href="#note1">1</a></sup> The information was originally marked up in <a
                href="http://troff.org/">troff</a>, an old UNIX typesetting language, to support the
            publication of the <a href="http://www.hup.harvard.edu/catalog.php?isbn=9780916458911"
                >Harvard University Press print edition</a>. The troff files were subsequently
            converted first to SGML<sup><a href="#note2">2</a></sup> and then to XML; the XML
            version is now regarded as our archival source, and the locus where all corrections and
            modification are made.</p>
        <p>The following is a single collation block (one Karskij line) from the XML input file:</p>
        <pre>&lt;!-- snip --&gt;
&lt;block column="1" line="4"&gt;
    &lt;manuscripts&gt;
        &lt;Lav&gt;<span class="manuscripts">персида. ватрь. тоже </span>&lt;lb/&gt; <span class="manuscripts">и до индикиꙗ в долготу</span>&lt;/Lav&gt;
        &lt;Tro&gt;<span class="manuscripts">персида ватрь даже и до индикия в долготу</span>&lt;/Tro&gt;
        &lt;Rad&gt;<span class="manuscripts">персида. ватрь. доже и до ин</span>&lt;sup&gt;<span class="manuscripts">д</span>&lt;/sup&gt;<span class="manuscripts">икиа. в до</span>&lt;lb/&gt;<span class="manuscripts">лготоу</span>&lt;/Rad&gt;
        &lt;Aka&gt;<span class="manuscripts">персїда. ватръ. до</span>&lt;sup&gt;<span class="manuscripts">ж</span>&lt;/sup&gt;<span class="manuscripts">и и до индикїа. в долготѹ </span>&lt;lb/&gt;&lt;/Aka&gt;
        &lt;Ipa&gt;<span class="manuscripts">перь</span>&lt;lb/&gt;<span class="manuscripts">сида. ватрь. доже и до инь</span>&lt;lb/&gt;<span class="manuscripts">дикиꙗ. в долготу</span>&lt;/Ipa&gt;
        &lt;Xle&gt;<span class="manuscripts">персида. ватръ. даже и до индикїа. въ </span>&lt;lb/&gt;<span class="manuscripts"> долготоу</span>&lt;/Xle&gt;
    &lt;/manuscripts&gt;
    &lt;Bych&gt;<span class="editions">Персида, Ватрь, доже и до Индикия в долготу,</span>&lt;/Bych&gt;
    &lt;Shakh&gt;<span class="editions">Персида, Ватрь доже и до Индикия въ дълготу,</span>&lt;/Shakh&gt;
    &lt;Likh&gt;<span class="editions">Персида, Ватрь, доже и до Индикия в долготу,</span>&lt;/Likh&gt;
    &lt;paradosis&gt;
        &lt;Ost&gt;<span class="lemma">Персида, Ватрь доже и до Индикия въ дълготу,</span>&lt;/Ost&gt;
    &lt;/paradosis&gt;
&lt;/block&gt;
&lt;!-- snip --&gt;</pre>
        <p>The edition lists manuscripts first (the principal manuscripts are <em>Lav</em>,
                <em>Tro</em>, <em>Rad</em>, <em>Aka</em>, <em>Ipa</em>, and <em>Xle</em>; others are
            used selectively), then print editions (<em>Byč</em>, <em>Šax</em>, and <em>Lix</em>),
            and then our own reconstruction (<em>Ost</em>, which we translate <em>α</em> to before
            rendering). The XML input document can be converted to HTML in way that aligns the
            manuscripts by line, but not by word within the lines; after conversion, the HTML for
            the preceding block looks like:</p>
        <div class="pre-colored">
            <h3>1, 4</h3>
            <table>
                <tbody class="manuscripts">
                    <tr>
                        <th>Lav</th>
                        <td>персида. ватрь. тоже | и до индикиꙗ в долготу</td>
                    </tr>
                    <tr>
                        <th>Tro</th>
                        <td>персида ватрь даже и до индикия в долготу</td>
                    </tr>
                    <tr>
                        <th>Rad</th>
                        <td>персида. ватрь. доже и до ин<sup>д</sup>икиа. в до|лготоу </td>
                    </tr>
                    <tr>
                        <th>Aka</th>
                        <td>персїда. ватръ. до<sup>ж</sup>и и до индикїа. в долготѹ | </td>
                    </tr>
                    <tr>
                        <th>Ipa</th>
                        <td>перь|сида. ватрь. доже и до инь|дикиꙗ. в долготу</td>
                    </tr>
                    <tr>
                        <th>Xle</th>
                        <td>персида. ватръ. даже и до индикїа. въ | долготоу</td>
                    </tr>
                </tbody>
                <tbody class="editions">
                    <tr>
                        <th>Byč</th>
                        <td>Персида, Ватрь, доже и до Индикия в долготу,</td>
                    </tr>
                    <tr>
                        <th>Šax</th>
                        <td>Персида, Ватрь доже и до Индикия въ дълготу,</td>
                    </tr>
                    <tr>
                        <th>Lix</th>
                        <td>Персида, Ватрь, доже и до Индикия в долготу,</td>
                    </tr>
                </tbody>
                <tbody class="lemma">
                    <tr>
                        <th>α</th>
                        <td>Персида, Ватрь доже и до Индикия въ дълготу,</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <h3>The problem</h3>
        <p>The problem CollateOS was designed to address was to align manuscript witnesses on a
            word-by-word level. Since for the PVL we had already performed manual alignment at the
            line level, we treated each line block as a separate collation problem, thus leveraging
            the initial coarse alignment and removing the possibility of misalignment that might
            cross line blocks. Within our project, then, we converted the line-by-line alignment,
            like the one above, into a word-by-word one. Since the witnesses may disagree not only
            in the spellings of the words, but also in insertions, deletions, replacements, and
            transpositions, this is not a simple task, and it requires aligning the words in the
            witnesses not just by position in the line, but also by their textual content. A simple
            Levenshtein edit-distance calculation is too crude for this task because not all
            variation is equally important for alignment purposes, and intelligent normalization
            before collation must ignore orthographic variation that is not textually significant
            while remaining attentive to variation that philologists consider meaningful. The
            remainder of this paper describes the process of applying intelligent normalization to
            the manuscript evidence in order to obtain more accurate results from <a
                href="http://collatex.net">CollateX</a>. The normalized version <em>shadows</em> the
            original; it is used by CollateX to align the manuscripts, but the resulting edition
            retains all original orthographic detail. </p>
        <h3>Transformation 1: Custom XML to word-tagged TEI XML (XSLT)</h3>
        <p>We first convert the initial custom XML markup to markup that is consistent with the
            guidelines of the <a href="http://www.tei-c.org">Text encoding initiative (TEI)</a>
            using <a href="../dev/xml-to-tei.xsl">xml-to-tei.xsl</a>. Our initial custom XML schema
            and the TEI XML markup have different advantages; by authoring in the former and then
            converting to the latter, we are able to use each at a stage in production where it is
            most beneficial.<sup><a href="#note3">3</a></sup></p>
        <p>The output of the <a href="../dev/xml-to-tei.xsl">xml-to-tei.xsl</a> process looks
            like:</p>
        <pre>&lt;!-- snip --&gt;
&lt;div type="block" n="4"&gt;
    &lt;p&gt;
        &lt;app&gt;
            &lt;lem wit="#lem"&gt;<span class="manuscripts">Персида, Ватрь доже и до Индикия въ дълготу,</span>&lt;/lem&gt;
            &lt;rdgGrp type="manuscripts"&gt;
                &lt;rdg wit="#lav"&gt;<span class="manuscripts">персида. ватрь. тоже </span>&lt;lb/&gt;<span class="manuscripts"> и до индикиꙗ в долготу</span>&lt;/rdg&gt;
                &lt;rdg wit="#tro"&gt;<span class="manuscripts">персида ватрь даже и до индикия в долготу</span>&lt;/rdg&gt;
                &lt;rdg wit="#rad"&gt;<span class="manuscripts">персида. ватрь. доже и до ин</span>&lt;hi rend="sup"&gt;<span class="manuscripts">д</span>&lt;/hi&gt;<span class="manuscripts">икиа. в до</span>&lt;lb/&gt;<span class="manuscripts">лготоу</span>&lt;/rdg&gt;
                &lt;rdg wit="#aka"&gt;<span class="manuscripts">персїда. ватръ. до</span>&lt;hi rend="sup"&gt;<span class="manuscripts">ж</span>&lt;/hi&gt;<span class="manuscripts">и и до индикїа. в долготѹ </span>&lt;lb/&gt;&lt;/rdg&gt;
                &lt;rdg wit="#ipa"&gt;<span class="manuscripts">перь</span>&lt;lb/&gt;<span class="manuscripts">сида. ватрь. доже и до инь</span>&lt;lb/&gt;<span class="manuscripts">дикиꙗ. в долготу</span>&lt;/rdg&gt;
                &lt;rdg wit="#xle"&gt;<span class="manuscripts">персида. ватръ. даже и до индикїа. въ </span>&lt;lb/&gt;<span class="manuscripts"> долготоу</span>&lt;/rdg&gt;
            &lt;/rdgGrp&gt;
            &lt;rdgGrp type="editions"&gt;
                &lt;rdg wit="#bych"&gt;<span class="editions">Персида, Ватрь, доже и до Индикия в долготу,</span>&lt;/rdg&gt;
                &lt;rdg wit="#shakh"&gt;<span class="editions">Персида, Ватрь доже и до Индикия въ дълготу,</span>&lt;/rdg&gt;
                &lt;rdg wit="#likh"&gt;<span class="editions">Персида, Ватрь, доже и до Индикия в долготу,</span>&lt;/rdg&gt;
            &lt;/rdgGrp&gt;
        &lt;/app&gt;
    &lt;/p&gt;
&lt;/div&gt;
&lt;!-- snip --&gt;</pre>
        <p>We next split the different blocks into separate files, using <a
                href="../dev/split-tei-into-collation-blocks.xsl"
                >split-tei-into-collation-blocks.xsl</a>, which creates a separate TEI file for each
            block, writing them into a <q>blocks</q> subdirectory. Filenames take the form
                <em>xxxx_xxxx_xxxx.xml</em>, where the first <q>xxxx</q> is a decimal number
            representing the order of the block in the entire edition, the second is the Karskij
            column number, and the third is the Karskij line number. For example,
                <q>7981_0277_0028.xml</q> is the 7981st file and represents column 277, line 28.
            (Line numbers may also contain hyphens and letters, about which see pp. lxxv–lxxvi of
            the <a href="http://hudce7.harvard.edu/~ostrowski/pvl/techpref.pdf">Principles of
                transcription</a> of the 2003 Harvard University Press print edition.)</p>
        <p>Tokenization for our alignment purposes is not as simple as splitting the input files on
            white space, we next use <a href="../dev/add-word-markup.xsl">add-word-markup.xsl</a> to
            wrap <code>&lt;w&gt;</code> tags around the individual words using. We run this from a
            shell script, <a href="../dev/add-word-markup">add-word-markup</a>, which iterates over
            the 8239 blocks and writes the results into a <q>blocks/word-tagged</q> subfolder. The
            word-tagged version of the block above is:</p>
        <pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;TEI xmlns="http://www.tei-c.org/ns/1.0"&gt;
    &lt;teiHeader&gt;
        &lt;fileDesc&gt;
            &lt;titleStmt&gt;
                &lt;title&gt;1, 4&lt;/title&gt;
            &lt;/titleStmt&gt;
            &lt;publicationStmt&gt;
                &lt;p&gt;Unpublished interim file for collation&lt;/p&gt;
            &lt;/publicationStmt&gt;
            &lt;sourceDesc&gt;
                &lt;p&gt;Extracted from pvl-tei.xml&lt;/p&gt;
            &lt;/sourceDesc&gt;
        &lt;/fileDesc&gt;
    &lt;/teiHeader&gt;
    &lt;text&gt;
        &lt;body&gt;
            &lt;milestone unit="column" n="1"/&gt;
            &lt;div type="block" n="4"&gt;
                &lt;p&gt;
                    &lt;app&gt;
                        &lt;lem wit="#lem"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Персида,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Ватрь</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Индикия</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">въ</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">дълготу,</span>&lt;/w&gt;
                        &lt;/lem&gt;

                        &lt;rdg wit="#lav"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">персида.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватрь.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">тоже &lt;lb/&gt;</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">индикиꙗ</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготу</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#tro"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">персида</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватрь</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">даже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">индикия</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготу</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#rad"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">персида.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватрь.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ин</span>&lt;hi rend="sup"&gt;<span class="manuscripts">д</span>&lt;/hi&gt;<span class="manuscripts">икиа.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до&lt;lb/&gt;лготоу</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#aka"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">персїда.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватръ.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;hi rend="sup"&gt;<span class="manuscripts">ж</span>&lt;/hi&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">индикїа.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготѹ </span>&lt;lb/&gt;&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#ipa"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">перь</span>&lt;lb/&gt;<span class="manuscripts">сида.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватрь.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">инь</span>&lt;lb/&gt;<span class="manuscripts">дикиꙗ.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготу</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#xle"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">персида.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">ватръ.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">даже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">индикїа.</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">въ </span>&lt;lb/&gt;&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготоу</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#bych"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Персида,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Ватрь,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Индикия</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготу,</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#shakh"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Персида,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Ватрь</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Индикия</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">въ</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">дълготу,</span>&lt;/w&gt;
                        &lt;/rdg&gt;

                        &lt;rdg wit="#likh"&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Персида,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Ватрь,</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">доже</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">и</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">до</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">Индикия</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">в</span>&lt;/w&gt;
                            &lt;w n="1,4"&gt;<span class="manuscripts">долготу,</span>&lt;/w&gt;
                        &lt;/rdg&gt;
                    &lt;/app&gt;
                &lt;/p&gt;
            &lt;/div&gt;
        &lt;/body&gt;
    &lt;/text&gt;
&lt;/TEI&gt;</pre>
        <p>The entire initial XML-to-XML conversion procedure, run from a directory that contains
            the original custom XML file, is:</p>
        <pre>saxon -o:pvl-tei.xml -s:pvl.xml -xsl:xml-to-tei.xsl
saxon pvl-tei.xml split-tei-into-collation-blocks.xsl
./add-word-markup</pre>
        <h3>Transformation 2: Word-tagged TEI XML to word-aligned XML</h3>
        <p>We transform the word-tagged TEI XML to word-aligned XML by piping it through three
            Python programs, which we invoke using a single wrapper program:</p>
        <ul>
            <li><a href="../dev/XMLtoJSON.py">XMLtoJSON.py</a> iterates through word-tagged TEI XML
                files in the specified input folder and transforms them to JSON in a form that can
                be read by CollateX.</li>
            <li><a href="../dev/runCollatex.py">runCollatex.py</a> iterates through the JSON files
                in the specified input directory (created as output to the preceding step) and
                spawns a CollateX process for each of the JSON files. The output of the CollateX
                process is another JSON file.</li>
            <li><a href="JSONtoXML.py">JSONtoXML.py</a> iterates through JSON files produced by
                CollateX and creates an XML file from each.</li>
        </ul>
        <p>The programs above call <a href="../dev/Preprocessing.py">Preprocessing.py</a>, which
            applies Soundex normalization rules (see <a href="#soundex">below</a>) to each token,
            creating a shadow version that will be used by CollateX to generate the aligned output.
            This module is called only by other scripts, and is not intended to be run directly by
            the user.</p>
        <p>The three Python programs can be run by a wrapper program, <a href="../dev/wrapper.py"
                >Wrapper.py</a>, which calls <a href="../dev/XMLtoJSON.py">XMLtoJSON.py</a>, pipes
            the output to <a href="../dev/runCollatex.py">runCollatex.py</a>, and then pipes that
            output to <a href="../dev/JSONtoXML.py">JSONtoXML.py</a>. To process all XML input files
            in the <q>blocks</q> subdirectory of the current working directory, run:</p>
        <pre>python /path-to-scripts/wrapper.py XMLtoJSON.py -new -i blocks</pre>
        <p>The <em>-new</em> switch creates a <q>collatexOutput</q> folder in the original input
            directory and writes the output there, so as not to overwrite input and interim files.
            When the smoke clears, <q>blocks</q> will contain the original word-tagged XML input
            files and the JSON output of XMLtoJSON.py; it will also contain a <q>collatexOutput</q>
            subdirectory with the JSON output of CollateX and the XML output created by converting
            the CollateX JSON output to custom (not TEI-conformant) XML. The filenames are
            consistent with the input filenames, with appropriate extensions (<q>.xml</q> and
                <q>.json</q>). The JSON output of XMLtoJSON.py looks like:</p>
        <pre>{"witnesses": [
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "Персида,",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "Ватрь",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "Индикия",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "въ",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "дълготу,",
                "n": "длгт"
            }
        ],
        "id": "#lem"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "персида.",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватрь.",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "тоже &lt;lb/&gt;",
                "n": "тжXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "индикиꙗ",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготу",
                "n": "длгт"
            }
        ],
        "id": "#lav"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "персида",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватрь",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "даже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "индикия",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготу",
                "n": "длгт"
            }
        ],
        "id": "#tro"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "персида.",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватрь.",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "ин&lt;hi rend=\"sup\"&gt;д&lt;\/hi&gt;икиа.",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "до&lt;lb/&gt;лготоу",
                "n": "длгт"
            }
        ],
        "id": "#rad"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "персїда.",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватръ.",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "до&lt;hi rend=\"sup\"&gt;ж&lt;\/hi&gt;и",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "индикїа.",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготѹ &lt;lb/&gt;",
                "n": "длгт"
            }
        ],
        "id": "#aka"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "перь&lt;lb/&gt;сида.",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватрь.",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "инь&lt;lb/&gt;дикиꙗ.",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготу",
                "n": "длгт"
            }
        ],
        "id": "#ipa"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "персида.",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "ватръ.",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "даже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "индикїа.",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "въ &lt;lb/&gt;",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготоу",
                "n": "длгт"
            }
        ],
        "id": "#xle"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "Персида,",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "Ватрь,",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "Индикия",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготу,",
                "n": "длгт"
            }
        ],
        "id": "#bych"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "Персида,",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "Ватрь",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "Индикия",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "въ",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "дълготу,",
                "n": "длгт"
            }
        ],
        "id": "#shakh"
    },
    {
        "tokens": [
            {
                "u": "1,4",
                "t": "Персида,",
                "n": "прсд"
            },
            {
                "u": "1,4",
                "t": "Ватрь,",
                "n": "втрX"
            },
            {
                "u": "1,4",
                "t": "доже",
                "n": "джXX"
            },
            {
                "u": "1,4",
                "t": "и",
                "n": "иXXX"
            },
            {
                "u": "1,4",
                "t": "до",
                "n": "дXXX"
            },
            {
                "u": "1,4",
                "t": "Индикия",
                "n": "индк"
            },
            {
                "u": "1,4",
                "t": "в",
                "n": "вXXX"
            },
            {
                "u": "1,4",
                "t": "долготу,",
                "n": "длгт"
            }
        ],
        "id": "#likh"
    }
]}</pre>
        <p>The JSON output of CollateX looks like the following (the <q>u</q> value is the column
            and line number, the <q>t</q> value is the original XML input, and the <q>n</q> value is
            the Soundex-normalized form) that CollateX uses for alignment. We set a Levenshtein
            distance threshhold value of 1, so that approximate matches not covered by our Soundex
            normalization will also be aligned.</p>
        <pre>{
    "witnesses": [
        "#aka",
        "#bych",
        "#ipa",
        "#lav",
        "#lem",
        "#likh",
        "#rad",
        "#shakh",
        "#tro",
        "#xle"
    ],
    "table": [
        [
            [{
                "u": "1,1",
                "t": "се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "Се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "Се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "Се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "Се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "се",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "Се",
                "n": "сXXX"
            }]
        ],
        [
            [{
                "u": "1,1",
                "t": "на&lt;lb/&gt;чнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемь",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начьнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начн&lt;hi rend=\"sup\"&gt;м&lt;\/hi&gt;е",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начьнѣмъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемъ",
                "n": "нчнм"
            }],
            [{
                "u": "1,1",
                "t": "начнемъ &lt;lb/&gt;",
                "n": "нчнм"
            }]
        ],
        [
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "по&lt;lb/&gt;вѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }],
            [{
                "u": "1,1",
                "t": "повѣсть",
                "n": "пвст"
            }]
        ],
        [
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию.",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сию",
                "n": "сXXX"
            }],
            [{
                "u": "1,1",
                "t": "сїю.",
                "n": "сXXX"
            }]
        ]
    ]
}</pre>
        <p>JSONtoXML.py converts the CollateX JSON output to XML like the following:</p>
        <pre>&lt;?xml version="1.0" ?&gt;
&lt;witnesses&gt;
    &lt;block&gt;
        &lt;token n="прсд" u="1,4" witness="#aka"&gt;персїда.&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#bych"&gt;Персида,&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#ipa"&gt;перь&lt;lb/&gt;сида.&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#lav"&gt;персида.&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#lem"&gt;Персида,&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#likh"&gt;Персида,&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#rad"&gt;персида.&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#shakh"&gt;Персида,&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#tro"&gt;персида&lt;/token&gt;
        &lt;token n="прсд" u="1,4" witness="#xle"&gt;персида.&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="втрX" u="1,4" witness="#aka"&gt;ватръ.&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#bych"&gt;Ватрь,&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#ipa"&gt;ватрь.&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#lav"&gt;ватрь.&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#lem"&gt;Ватрь&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#likh"&gt;Ватрь,&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#rad"&gt;ватрь.&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#shakh"&gt;Ватрь&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#tro"&gt;ватрь&lt;/token&gt;
        &lt;token n="втрX" u="1,4" witness="#xle"&gt;ватръ.&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="джXX" u="1,4" witness="#aka"&gt;до&lt;hi rend="sup"&gt;ж&lt;/hi&gt;и&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#bych"&gt;доже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#ipa"&gt;доже&lt;/token&gt;
        &lt;token n="тжXX" u="1,4" witness="#lav"&gt;тоже &lt;lb/&gt;&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#lem"&gt;доже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#likh"&gt;доже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#rad"&gt;доже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#shakh"&gt;доже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#tro"&gt;даже&lt;/token&gt;
        &lt;token n="джXX" u="1,4" witness="#xle"&gt;даже&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="иXXX" u="1,4" witness="#aka"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#bych"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#ipa"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#lav"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#lem"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#likh"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#rad"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#shakh"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#tro"&gt;и&lt;/token&gt;
        &lt;token n="иXXX" u="1,4" witness="#xle"&gt;и&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="дXXX" u="1,4" witness="#aka"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#bych"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#ipa"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#lav"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#lem"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#likh"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#rad"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#shakh"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#tro"&gt;до&lt;/token&gt;
        &lt;token n="дXXX" u="1,4" witness="#xle"&gt;до&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="индк" u="1,4" witness="#aka"&gt;индикїа.&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#bych"&gt;Индикия&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#ipa"&gt;инь&lt;lb/&gt;дикиꙗ.&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#lav"&gt;индикиꙗ&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#lem"&gt;Индикия&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#likh"&gt;Индикия&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#rad"&gt;ин&lt;hi rend="sup"&gt;д&lt;/hi&gt;икиа.&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#shakh"&gt;Индикия&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#tro"&gt;индикия&lt;/token&gt;
        &lt;token n="индк" u="1,4" witness="#xle"&gt;индикїа.&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="вXXX" u="1,4" witness="#aka"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#bych"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#ipa"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#lav"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#lem"&gt;въ&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#likh"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#rad"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#shakh"&gt;въ&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#tro"&gt;в&lt;/token&gt;
        &lt;token n="вXXX" u="1,4" witness="#xle"&gt;въ &lt;lb/&gt;&lt;/token&gt;
    &lt;/block&gt;
    &lt;block&gt;
        &lt;token n="длгт" u="1,4" witness="#aka"&gt;долготѹ &lt;lb/&gt;&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#bych"&gt;долготу,&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#ipa"&gt;долготу&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#lav"&gt;долготу&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#lem"&gt;дълготу,&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#likh"&gt;долготу,&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#rad"&gt;до&lt;lb/&gt;лготоу&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#shakh"&gt;дълготу,&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#tro"&gt;долготу&lt;/token&gt;
        &lt;token n="длгт" u="1,4" witness="#xle"&gt;долготоу&lt;/token&gt;
    &lt;/block&gt;
&lt;/witnesses&gt;</pre>
        <p>For web publication we use <a href="../dev/xmlobjects-to-column-html-tables.xsl"
                >xmlobjects-to-column-html-tables.xsl</a> to combine the blocks for each column into
            a single HTML fragment which can be incorporated into a browsing interface using server
            side includes and AJAX. The resulting word-aligned block looks like:</p>
        <div class="pre-colored">
            <p id="b1_4" class="columnNumber">1,4</p>
            <table class="collation-example">
                <tbody class="manuscripts">
                    <tr>
                        <th>Lav</th>
                        <td>персида.</td>
                        <td>ватрь.</td>
                        <td>тоже </td>
                        <td>и</td>
                        <td>до</td>
                        <td>индикиꙗ</td>
                        <td>в</td>
                        <td>долготу</td>
                    </tr>
                    <tr>
                        <th>Tro</th>
                        <td>персида</td>
                        <td>ватрь</td>
                        <td>даже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>индикия</td>
                        <td>в</td>
                        <td>долготу</td>
                    </tr>
                    <tr>
                        <th>Rad</th>
                        <td>персида.</td>
                        <td>ватрь.</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>ин<sup>д</sup>икиа.</td>
                        <td>в</td>
                        <td>долготоу</td>
                    </tr>
                    <tr>
                        <th>Aka</th>
                        <td>персїда.</td>
                        <td>ватръ.</td>
                        <td>до<sup>ж</sup>и</td>
                        <td>и</td>
                        <td>до</td>
                        <td>индикїа.</td>
                        <td>в</td>
                        <td>долготѹ </td>
                    </tr>
                    <tr>
                        <th>Ipa</th>
                        <td>перьсида.</td>
                        <td>ватрь.</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>иньдикиꙗ.</td>
                        <td>в</td>
                        <td>долготу</td>
                    </tr>
                    <tr>
                        <th>Xle</th>
                        <td>персида.</td>
                        <td>ватръ.</td>
                        <td>даже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>индикїа.</td>
                        <td>въ </td>
                        <td>долготоу</td>
                    </tr>
                </tbody>
                <tbody class="editions">
                    <tr>
                        <th>Byč</th>
                        <td>Персида,</td>
                        <td>Ватрь,</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>Индикия</td>
                        <td>в</td>
                        <td>долготу,</td>
                    </tr>
                    <tr>
                        <th>Šax</th>
                        <td>Персида,</td>
                        <td>Ватрь</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>Индикия</td>
                        <td>въ</td>
                        <td>дълготу,</td>
                    </tr>
                    <tr>
                        <th>Lix</th>
                        <td>Персида,</td>
                        <td>Ватрь,</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>Индикия</td>
                        <td>в</td>
                        <td>долготу,</td>
                    </tr>
                </tbody>
                <tbody class="lemma">
                    <tr>
                        <th>α</th>
                        <td>Персида,</td>
                        <td>Ватрь</td>
                        <td>доже</td>
                        <td>и</td>
                        <td>до</td>
                        <td>Индикия</td>
                        <td>въ</td>
                        <td>дълготу,</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>The full edition is available at <a href="http://pvl.obdurodon.org/browser.xhtml"
                >http://pvl.obdurodon.org/browser.xhtml</a>.</p>
        <h5>2.2. Expected input and output</h5>
        <table>
            <tr>
                <th>Script</th>
                <th>Input</th>
                <th>Output</th>
            </tr>
            <tr>
                <td>XMLToJSON.py</td>
                <td>-i <em>path to the folder with XML files</em></td>
                <td>JSON files ready to be run through collatex written to the input folder</td>
            </tr>
            <tr>
                <td>XMLSToJSON.py</td>
                <td>-i <em>path to the folder with XML files</em><br /> -o <em>path to the JSON file
                        for the output to be written to</em></td>
                <td>a single JSON file specified after -o flag</td>
            </tr>
            <tr>
                <td>runCollatex.py</td>
                <td>-i <em>path to the JSON files used as input to CollateX</em> [-new] if intending
                    not to overwrite existing JSONs. This will create a <q>collatexOutput</q> folder
                    in the directory of the input files and write output there.</td>
                <td>Output of the CollateX application either overwriting the original files or
                    writing to collatexOutput</td>
            </tr>
            <tr>
                <td>JSONToXML.py</td>
                <td>-i <em>path to the folder with JSON files created by CollateX</em></td>
                <td>XML files in the output directory to be used in _____.xsl to create the single
                    HTML file</td>
            </tr>
            <tr>
                <td>Preprocessing.py</td>
                <td>N/A, not intended to be ran by the user</td>
                <td>N/A, not intended to be ran by the user</td>
            </tr>
            <tr>
                <td>Wrapper.py</td>
                <td>name of the script being ran (xmltojson.py or xmlstojson.py)<br /> -i <em>path
                        to the folder with XML files</em><br /> -o <em>path to the JSON file for the
                        output to be written to</em> (if running xmlstojson.py only)<br /> [-new] if
                    intending not to overwrite existing JSONs. This will create a
                        <q>collatexOutput</q> folder in the directory of the input files and write
                    output there.</td>
                <td> JSON files for each input XML (if running xmltojson.py)<br /> A single JSON
                    file with all witnesses combined (if running xmlstojson.py)<br /> Output of the
                    CollateX application either overwriting the files above or writing to
                    collatexOutput folder<br /> XML files in the output directory to be used in
                    _____.xsl to create the single HTML file</td>
            </tr>
        </table>
        <ul>
            <li>Inputs should be given as command-line arguments</li>
            <li>[] Signifies an optional argument</li>
            <li>Order of input arguments matters in most cases; it is advised to use them in the
                order they are presented here.</li>
        </ul>
        <h3>Normalization algorithm</h3>
        <p>The original XML input is retained throughout and process and used in the eventual
            edition, but a normalized shadow view is created as follows:</p>
        <ol>
            <li>Remove all opening and closing tags of the following elements (some TEI, some from
                alternative markup schemes that are also supported): <code>&lt;add&gt;</code>,
                    <code>&lt;hi&gt;</code>, <code>&lt;unclear&gt;</code>, keeping their inner text
                node intact.</li>
            <li>Remove the following elements entirely: <code>&lt;del&gt;</code>,
                    <code>&lt;gap&gt;</code>, <code>&lt;lacuna&gt;</code>, <code>&lt;lb&gt;</code>,
                    <code>&lt;pb&gt;</code></li>
            <li>If a <code>&lt;choice&gt;</code> element is present, choose the second member of
                each of the following pairs: (<code>&lt;sic&gt;</code>, <code>&lt;corr&gt;</code>),
                    (<code>&lt;orig&gt;</code>, <code>&lt;reg&gt;</code>),
                    (<code>&lt;abbr&gt;</code>, <code>&lt;expan&gt;</code>),
                    (<code>&lt;seg&gt;</code>, <code>&lt;seg&gt;</code>)</li>
            <li>Ignore other markup, operating just on the data content of the words from now
                on.</li>
            <li>Remove all punctuation.</li>
            <li>If at this point length of our text is 0, the node originally contained only
                punctuation, so return a normalized value of <q>PUNC</q>. Otherwise, continue.</li>
            <li>Check for presence of arabic numbers in the string. If any are found, transform them
                to their cyrillic counterparts.</li>
            <li>Apply Soundex normalization, as modified for early Slavic Cyrillic writing (see the
                    <a href="#soundex">description of the Cyrillic-specific algorithm, below</a>),
                as follows:<ol>
                    <li>Apply orthograpic transformation rules outlined in <a
                            href="../dev/soundex-rules.xml">soundex-rules.xml</a> in the following
                        order: <code>$manyToOne</code>, <code>$oneToMany</code>,
                            <code>$oneToOne</code>. This merges letterforms that frequently appear
                        as orthographic variants that are not meaningful for collation purposes,
                        much as the original Soundex algorithm ignored orthographic variation that
                        interfered with retrieving English-language surnames (see the brief
                        description and history of Soundex at <a
                            href="http://en.wikipedia.org/wiki/Soundex"
                            >http://en.wikipedia.org/wiki/Soundex</a>).</li>
                    <li>Eliminate vowels from <q>Special vowels</q> category from <a
                            href="../dev/vowels.xml">vowels.xml</a>, unless they are
                        word-initial</li>
                    <li>Degeminate consonants (e.g., <q>нн</q> becomes <q>н</q>) and remove all
                        vowels from the rest of the word. Note that word-initial letter is retained
                        even if it is a vowel, but other vowels are eventually deleted.</li>
                    <li>If the length of the resulting normalized is longer than 4, truncate it to
                        4. If it’s less than 4, pad it with <q>X</q> (upper-case Latin letter)
                        characters.</li>
                </ol></li>
        </ol>
        <hr />
        <h3 id="soundex">Soundex normalization</h3>
        <p>[Describe Soundex normalization here]</p>
        <hr />
        <h3>Notes</h3>
        <ol>
            <li id="note1"><sup>1</sup> Карский, Евфимий Федорович, ред. 1926. <cite>Лаврентьевская
                    летопись.</cite> 2-е изд. Вып.1. <cite>Повесть временных лет.</cite> Ленинград:
                АН СССР.</li>
            <li id="note2"><sup>2</sup> Birnbaum, David J. 2000. In <q>A TEI-Compatible Edition of
                    the Rusʹ Primary Chronicle.</q>
                <cite>Medieval Slavic Manuscripts and SGML: Problems and Perspectives,</cite> ed.
                Anisava Miltenova and David J. Birnbaum, 15–43. Sofia: Institute of Literature,
                Bulgarian Academy of Sciences, Marin Drinov Publishing House.</li>
            <li id="note3"><sup>3</sup> Birnbaum, David J. 2000. <q>The relationship between general
                    and specific DTDs: criticizing TEI critical editions.</q>
                <cite>Markup languages: theory and practice</cite> 3, no. 1:17–53. </li>
        </ol>
        <p>PVL project site <a href="http://pvl.obdurodon.org">http://pvl.obdurodon.org</a>.
            CollateOS GitHub repository <a href="https://github.com/obdurodon/CollateOS"
                >https://github.com/obdurodon/CollateOS</a>. Thanks to Ronald Dekker and the rest of
            the CollateX development team for their advice.</p>
    </body>
</html>
